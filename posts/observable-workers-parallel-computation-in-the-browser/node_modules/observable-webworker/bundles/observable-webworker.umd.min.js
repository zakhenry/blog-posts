!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("observable-webworker",["exports","rxjs","rxjs/operators"],r):r((e=e||self)["observable-webworker"]={},e.rxjs,e.rxjs.operators)}(this,function(e,r,n){"use strict";function t(e,r){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var t,o,i=n.call(e),a=[];try{for(;(void 0===r||r-- >0)&&!(t=i.next()).done;)a.push(t.value)}catch(e){o={error:e}}finally{try{t&&!t.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function o(e){return!!e.selectTransferables}function i(e){return!!e.workUnit}function a(e,t){var o=t.pipe(n.map(function(e){return e.data}),n.map(function(e){return new r.Notification(e.kind,e.value,e.error)}),n.filter(function(e){return"C"!==e.kind}),n.dematerialize());return i(e)?o.pipe(n.concatMap(function(r){return e.workUnit(r).pipe(n.materialize())})):e.work(o).pipe(n.materialize())}function u(e){var n=new e,t=r.fromEvent(self,"message"),i=o(n);return a(n,t).subscribe(function(e){var r=postMessage;i&&e.hasValue?r(e,n.selectTransferables(e.value)):r(e)})}function s(e,t,o,i){return void 0===i&&(i={terminateOnComplete:!0}),new r.Observable(function(r){var a,u;try{(a=e()).onmessage=function(e){return r.next(e.data)},a.onerror=function(e){return r.error(e)},u=t.pipe(n.materialize(),n.tap(function(e){if(o&&e.hasValue){var r=o(e.value);a.postMessage(e,r)}else a.postMessage(e)})).subscribe()}catch(e){r.error(e)}return function(){u&&u.unsubscribe(),a&&i.terminateOnComplete&&a.terminate()}}).pipe(n.map(function(e){var n=e.kind,t=e.value,o=e.error;return new r.Notification(n,t,o)}),n.dematerialize())}e.ObservableWorker=function(){return function(e){u(e)}},e.fromWorker=s,e.fromWorkerPool=function(e,o,i){var a=i||{},u=a.selectTransferables,c=void 0===u?void 0:u,f=a.workerCount,l=void 0===f?navigator.hardwareConcurrency-1:f,p=a.flattenOperator,d=void 0===p?n.mergeAll():p;return new r.Observable(function(i){var a=new r.Subject,u=0,f=0,p=!1,m=Array.from({length:l}).map(function(r,n){return{_cachedWorker:null,factory:function(){return this._cachedWorker||(this._cachedWorker=e(n),this.started=!0),this._cachedWorker},terminate:function(){this.started&&!this.processing&&this._cachedWorker.terminate()},processing:!1,started:!1,index:n}}),b=r.zip(a,o).pipe(n.tap(function(e){var r=t(e,1)[0];f++,r.processing=!0}),n.finalize(function(){a.complete(),p=!0,m.forEach(function(e){return e.terminate()})}),n.map(function(e){var o=t(e,2),l=o[0],d=o[1];return s(function(){return l.factory()},r.of(d),c,{terminateOnComplete:!1}).pipe(n.finalize(function(){u++,l.processing=!1,p?l.terminate():a.next(l),p&&u===f&&i.complete()}))}),d).subscribe(i);return m.forEach(function(e){return a.next(e)}),function(){return b.unsubscribe()}})},e.getWorkerResult=a,e.runWorker=u,e.workerIsTransferableType=o,e.workerIsUnitType=i,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=observable-webworker.umd.min.js.map